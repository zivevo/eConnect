name: CI/CD Workflow

on:
  push:
    branches:
      - main
      - build/*
  pull_request:
    branches:
      - main
      - build/*

jobs:
  setup:
    name: Checkout Repositories and Setup
    runs-on: ubuntu-latest

    steps:
      - name: Checkout eConnect Repository
        uses: actions/checkout@v3

      - name: Checkout eConnect-frontend Repository
        uses: actions/checkout@v3
        with:
          repository: zivevo/eConnect-frontend
          path: eConnect-frontend

      - name: Checkout eConnect-backend Repository
        uses: actions/checkout@v3
        with:
          repository: zivevo/eConnect-backend
          path: eConnect-backend

  docker-compose:
    name: Docker Compose Setup
    runs-on: ubuntu-latest
    needs: setup

    steps:
      - name: Checkout eConnect Repository
        uses: actions/checkout@v3

      - name: Start Docker Compose
        run: docker-compose up --build -d

      - name: Wait for Services to be Ready
        run: sleep 10 

  # tests:
  #   name: Run Tests and Lint Checks
  #   runs-on: ubuntu-latest
  #   needs: docker-compose

  #   steps:
  #     - name: Backend Tests
  #       run: docker-compose exec backend npm test

  #     - name: Backend Lint
  #       run: docker-compose exec backend npm run lint

  #     - name: Frontend Lint
  #       run: docker-compose exec frontend npm run lint

  deploy:
    name: Deployment (Optional)
    runs-on: ubuntu-latest
    needs: docker-compose

    steps:
      - name: Deploy to Environment
        run: echo "Deploy step goes here"
